UPDATE $section AS doc("sections.xml")/section
  WHERE
    $number, $stitle, $subsection IN $section/(number, title, subsection*)
BY
  MATCH $number AND $vnumber
  REPLACE $title WITH $vtitle;
  subsections($subsection, $sub)
 |CREATE FOLLOW LAST VALUE 
    let $section :=
      <section><number>$vnumber</number><title>$text</title></section> in $section ; 
   subsections($section/subsections,$sub)
 | DELETE SOURCE $section
ORDERBY $number
USE $vsec WHERE
    $vsec IN doc("secs.xml")/sec,
    $vnumber, $vtitle, $sub IN $vsec/(number, title, sub*)

subsections($subsection, $sub) =
  UPDATE $subsection 
  WHERE 
    $number, $title IN $subsecton/(number, title)
  BY
    MATCH $number AND $vnumber
    REPLACE $title WITH $vtitle
   |CREATE FOLLOW LAST VALUE
      <subsection><number>$vnumber</number><title>$title</title></subsection>
   |DELETE SOURCE $subsection
  ORDERBY $number
  USE $sub
  WHERE
     $vnumber, $vtitle IN $sub/(number, title)