PROCEDURE uSTransition($stateName AS String, source $tran AS IfReturnCode, view $deltas AS v:delta+) =
LET $deltaCount := $deltas/delta IN
IF count($deltaCount) = 1 THEN

UPDATE assignment[$left AS s:left, right[$sName AS String]] IN $tran BY
{
  MATCH  -> REPLACE $tran WITH 
                    <if><condition/>
		        <code>
                        <assignment>
                          {$left} 
                          <right>$deltaName</right>
                        </assignment>
		        </code>
                    </if>
 |UNMATCHV -> IF $deltaName != $stateName 
              THEN
                 CREATE VALUE
                    <if><condition/>
		        <code>
                        <assignment>
                          {$left} 
                          <right>$deltaName</right>
                        </assignment>
		        </code>
                    </if>
               ELSE 
}
FOR VIEW delta[$deltaName AS @target[String]] IN $deltas
MATCHING SOURCE BY $sName VIEW BY $deltaName

